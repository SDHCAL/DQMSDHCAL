<dqm4hep>

    <archiver open="true" directory="/tmp" />

    <network>
        <runcontrol type="DimRunControlClient" name="SDHCALRunControl" />

        <eventcollector type="DimEventClient">
        	<parameter name="collectorName"> sdhcal_event_collector </parameter>
        	<parameter name="maxQueueSize"> 100 </parameter>
        	<parameter name="streamerName"> LCIOStreamer </parameter>
        </eventcollector>

        <monitorelementcollector name="sdhcal_me_collector"/>
    </network>

    <cycle type="TimerCycle" value="10" timeout="5" />

    <module type="NoiseAnalysisModule" name="NoiseAnalysisModule">

        <parameter name="ShouldProcessStreamout">  false </parameter>

        <Streamout>
        	<parameter name="InputCollectionName">  RU_XDAQ </parameter>
        	<parameter name="OutputCollectionName">  DHCALRawHits </parameter>
        	<parameter name="XDaqShift">  92 </parameter>
        </Streamout>

        <parameter name="ShouldProcessTrivent">  false </parameter>

        <Trivent>
        	<parameter name="InputCollectionName">  DHCALRawHits </parameter>
        	<parameter name="OutputCollectionName">  SDHCAL_HIT </parameter>

        	<!-- To adjust ! -->
        	<parameter name="GeometryFile">  /Users/antoine/CALICE/Software/DQMSDHCAL/config/setup_geometry_nov.xml </parameter>

        	<parameter name="LayerCut">  3 </parameter>
        	<parameter name="NoiseCut">  10 </parameter>
        	<parameter name="TimeWindow">  2 </parameter>
        	<parameter name="LayerGap">  0.9 </parameter>
        	<parameter name="ElecNoiseCut">  100000 </parameter>
        	<parameter name="Time2PreviousEventCut">  0 </parameter>
        	<parameter name="GainCorrectionMode">  false </parameter>
        	<parameter name="CherenkovWindow">  20 </parameter>
        	<parameter name="CherenkovLenght">  1 </parameter>
        	<parameter name="CherenkovDifId">  0 </parameter>
        	<parameter name="TreatCherenkov">  false </parameter>
        	<parameter name="CellSizeU">  10.408 </parameter>
        	<parameter name="CellSizeV">  10.408 </parameter>

        	<!-- 26.131 for SDHCAL ; 55 at GIF++ -->
        	<parameter name="LayerThickness">  26.131 </parameter>
        </Trivent>


        <parameter name="InputCollectionName"> DHCALRawHits </parameter>
        <parameter name="DetectorName"> SDHCAL </parameter>
        <parameter name="GeometryFile">  /Users/antoine/CALICE/Software/DQMSDHCAL/config/setup_geometry2015.xml </parameter>

        <parameter name="NActiveLayers">  51 </parameter>
        <parameter name="NDifPerLayer">  3 </parameter>
        <parameter name="NAsicPerDif">  48 </parameter>
        <parameter name="NChanPerAsic">  64 </parameter>



        <!-- spillLength in seconds -->
        <parameter name="SpillLength">  10 </parameter>
        <!-- ClockFrameLength in ns -->
        <parameter name="ClockFrameLength">  200 </parameter>
        <parameter name="NumberOfEventToSkip">  0 </parameter>
        <parameter name="DropFirstSpillEvent">  false </parameter>

        <monitorElement ID="AsicOccupancyAll"
            name="AsicOccupancyAll" path="." type="TH1F" title="Occupancy per Asic / integrated time (in s)"
            nBins="12241" min="0" max="12240"
            resetPolicy="EndOfRun"/>
            <!-- 12240 = 255*48 = TotalDif * AsicPerDif -->

       <monitorElement ID="AsicOccupancyChamber"
            name="AsicOccupancyChamber" path="." type="TH1F" title="Asic Occupancy per chamber / integrated time (in s)"
            nBins="61" min="0" max="60"
            resetPolicy="EndOfRun"/>

        <monitorElement ID="AsicOccupancyDIF"
            name="AsicOccupancyDIF" path="." type="TH1F" title="Asic Occupancy per DIF / integrated time (in s)"
            nBins="256" min="0" max="255"
            resetPolicy="EndOfRun"/>

        <monitorElement ID="DIFAsicCount"
            name="DIFAsicCount" path="." type="TH2S" title="Occupancy ASIC vs DIF"
            nBinsX="256" minX="0.1" maxX="256.1" nBinsY="48" minY="0.1" maxY="48.1"
            drawOption="colz" resetPolicy="EndOfRun"/>

        <monitorElement ID="TimeDiffTriggerToSpill"
                name="TimeDiffTriggerToSpill" path="." type="TH1F" title="Time (s) between start time of new spill and start time of last trigger of previous Spill"
                nBins="500" min="0" max="100"
                resetPolicy="EndOfRun"/>

        <monitorElement ID="TimeDiffSpill"
                name="TimeDiffSpill" path="." type="TH1F" title="Time (s) between two start time of spill"
                nBins="500" min="0" max="100"
                resetPolicy="EndOfRun"/>

        <monitorElement ID="SpillLength"
                name="SpillLength" path="." type="TH1F" title="Spill Length in s"
                nBins="100" min="0" max="10"
                resetPolicy="EndOfRun"/>

        <monitorElement ID="AcquisitionTime"
                name="AcquisitionTime" path="." type="TH1F" title="Acquisition Time"
                nBins="2000" min="0" max="0.5"
                resetPolicy="EndOfRun"/>

        <monitorElement ID="HitFrequencyMap"
            name="HitFrequencyMap" path="." type="TH2F" title="HitMap DIF vs Asic"
            nBinsX="255" minX="0.1" maxX="255.1" nBinsY="48" minY="0.1" maxY="48.1"
            drawOption="colz" resetPolicy="EndOfRun"/>


        <monitorElement ID="ChamberHitsMap1"
            name="ChamberHitsMap1" path="." type="TH2S" title="HitMap in Layer threshold 1"
            nBinsX="97" minX="0" maxX="96" nBinsY="97" minY="0" maxY="96"
            drawOption="colz" resetPolicy="EndOfRun"/>

        <monitorElement ID="ChamberHitsMap2"
            name="ChamberHitsMap2" path="." type="TH2S" title="HitMap in Layer threshold 2"
            nBinsX="97" minX="0" maxX="96" nBinsY="97" minY="0" maxY="96"
            drawOption="colz" resetPolicy="EndOfRun"/>

        <monitorElement ID="ChamberHitsMap3"
            name="ChamberHitsMap3" path="." type="TH2S" title="HitMap in Layer threshold 3"
            nBinsX="97" minX="0" maxX="96" nBinsY="97" minY="0" maxY="96"
            drawOption="colz" resetPolicy="EndOfRun"/>


        <monitorElement ID="AsicOccupancy"
            name="AsicOccupancy" path="." type="TH1F" title="Occupancy per Asic over integrated time (in s)"
            nBins="48" min="0" max="47"
            resetPolicy="EndOfRun"/>

        <monitorElement ID="AsicOccupancyNumber"
            name="AsicOccupancyNumber" path="." type="TH1F" title="Raw Occupancy per Asic"
            nBins="48" min="0" max="47"
            resetPolicy="EndOfRun"/>

        <!-- 3072 = 48*64 = Asic * Pad -->
		<monitorElement ID="AsicHits1"
            name="AsicHits1" path="." type="TH1F" title="Hits per pad and asic threshold 1+2+3"
            nBins="3072" min="0" max="3071"
            resetPolicy="EndOfRun"/>

        <monitorElement ID="AsicHits2"
            name="AsicHits2" path="." type="TH1F" title="Hits per pad and asic threshold 2+3"
            nBins="3072" min="0" max="3071"
            resetPolicy="EndOfRun"/>

        <monitorElement ID="AsicHits3"
            name="AsicHits3" path="." type="TH1F" title="Hits per pad and asic threshold 3"
            nBins="3072" min="0" max="3071"
            resetPolicy="EndOfRun"/>

        <monitorElement ID="AsicEventTime"
            name="EventTime" path="." type="TH1F" title="Hit time distribution"
            nBins="10001" min="0" max="1E6"
            resetPolicy="EndOfRun"/>

        <monitorElement ID="AsicEventTimeZoom"
            name="EventTimeZoom" path="." type="TH1F" title="Zoom on hit time distribution"
            nBins="10001" min="0" max="10000"
            resetPolicy="EndOfRun"/>



    </module>

</dqm4hep>
